# Navier–Stokes Solver

Penguin provides a prototype incompressible Navier–Stokes solver built on the same
staggered velocity / collocated pressure framework used by the Stokes solvers.
The implementation currently supports 2D problems and exposes both unsteady and
steady solvers with two nonlinear solvers for the steady problem: Picard (fixed-point)
and Newton (full Newton-Raphson).

## Capabilities

- Unsteady solver: implicit viscous/pressure update with explicit Adams–Bashforth convection.
- Steady solver: two options
  - Picard: successive linearizations of the convection term (relaxation supported)
  - Newton: exact Jacobian formulation with full linearization of convection
- Staggered-grid discretization for velocities and collocated pressure
- Embedded-boundary support via capacity and cut-boundary operators

## Quick API

Construct a fluid and solver as with the Stokes examples (see `docs/src/blocks/stokes.md`).
The Navier–Stokes solver type is `NavierStokesMono` for single-phase problems.

Unsteady usage example:

```julia
using Penguin

# ... build meshes, capacities, operators, fluid and BCs ...

solver = NavierStokesMono(fluid, (bc_ux, bc_uy), bc_p, bc_cut; x0=zeros(Ntot))

times, histories = solve_NavierStokesMono_unsteady!(solver; Δt=Δt, T_end=Tend, scheme=:CN)
```

Steady usage (choose nonlinear solve method):

```julia
# Picard (default behavior in examples)
x, iters, res = solve_NavierStokesMono_steady!(solver; tol=1e-8, maxiter=50, relaxation=0.7, nlsolve_method=:picard)

# Newton
x, iters, res = solve_NavierStokesMono_steady!(solver; tol=1e-10, maxiter=25, nlsolve_method=:newton)
```

## Parameters and notes

- μ (mu): dynamic viscosity (passed via `Fluid`)
- ρ (rho): fluid density (passed via `Fluid`) — both are used consistently in convective and viscous terms.
- `relaxation`: Picard relaxation factor between 0.0 and 1.0 (smaller values improve stability).
- `tol`, `maxiter`: nonlinear solver stopping criteria.

## Boundary conditions

Dirichlet boundary conditions for velocity are enforced strongly via the assembly helpers (and they are taken into account inside both residual and Jacobian when using Newton).
A pressure gauge condition is applied to remove the nullspace for the pressure.

## Visualization and examples

See `examples/2D/NavierStokes/lid_driven_cavity_steady.jl` for a steady benchmark
(which can run with either Picard or Newton) and `examples/2D/NavierStokes/flow_around_circle_2d.jl` for an unsteady flow example.

The examples include plotting and animation using CairoMakie. The streamlines animation can be generated by running the unsteady example.

![Streamlines around a circular obstacle](./assets/navierstokes2d_streamlines.gif)

## Limitations and future work

- Only 2D Navier–Stokes implemented currently.
- Jacobian BC handling uses strong enforcement; more advanced constraint handling is planned.
- Preconditioning and scalable iterative solvers are work in progress.
- Variable-density / variable-viscosity flows need additional work (current code assumes constant ρ in linearizations).
